<div class="d-flex flex-column min-vh-100 bg-body-tertiary">
  <main class="flex-grow-1 main-content">
    <div class="container-fluid px-5 py-4" *ngIf="userProfile$ | async as user; else loading">

      <!-- Saludo -->
      <div class="card shadow border-0 mb-4 bg-primary text-white text-start px-4 py-3 rounded-3">
        <h4 class="fw-bold mb-1">Hola {{ user.nombre }} ðŸ‘‹</h4>
        <p class="mb-0 small">Bienvenido a tu panel. Gestiona tus finanzas de forma <u>rÃ¡pida</u> y <u>segura</u>.</p>
      </div>

      <div class="row gx-4 gy-4">
        <!-- Columna izquierda -->
        <div class="col-lg-8">

          <!-- Datos del usuario -->
          <div class="card shadow-sm border-0 mb-4 bg-white rounded-4 border-start border-5 border-primary">
            <div class="card-body d-flex align-items-start">
              <div
                class="rounded-circle bg-primary text-white d-flex justify-content-center align-items-center me-4 shadow"
                style="width: 60px; height: 60px; font-size: 1.5rem;">
                {{ user.nombre.charAt(0).toUpperCase() }}
              </div>
              <div class="flex-grow-1">
                <!-- Modo visual -->
                <div *ngIf="!isEditing">
                  <h5 class="fw-semibold">{{ user.nombre }} {{ user.apellido }}</h5>
                  <p class="text-muted mb-2">Perfil de usuario</p>
                  <div class="row">
                    <div class="col-md-6 mb-2">
                      <p class="mb-0 text-muted small"><i class="bi bi-envelope-fill me-2 text-primary"></i>Correo</p>
                      <strong>{{ user.email }}</strong>
                    </div>
                    <div class="col-md-6 mb-2">
                      <p class="mb-0 text-muted small"><i class="bi bi-calendar3 me-2 text-primary"></i>Nacimiento</p>
                      <strong>{{ user.fecha_nacimiento | date: 'dd/MM/yyyy' }}</strong>
                    </div>
                    <div class="col-md-6 mb-2">
                      <p class="mb-0 text-muted small"><i class="bi bi-geo-alt-fill me-2 text-primary"></i>UbicaciÃ³n</p>
                      <strong>{{ user.ciudad }}, {{ user.pais }}</strong>
                    </div>
                    <div class="col-md-6 mb-2">
                      <p class="mb-0 text-muted small"><i class="bi bi-person-badge me-2 text-primary"></i>RUT</p>
                      <strong>{{ user.rut }}</strong>
                    </div>
                  </div>
                </div>

                <!-- Modo ediciÃ³n -->
                <form *ngIf="isEditing" (ngSubmit)="guardarCambios()" #form="ngForm">
                  <div class="row g-2">
                    <div class="col-md-6">
                      <label class="form-label">Nombre</label>
                      <input class="form-control" [(ngModel)]="user.nombre" name="nombre">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Apellido</label>
                      <input class="form-control" [(ngModel)]="user.apellido" name="apellido">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Correo</label>
                      <input class="form-control" [(ngModel)]="user.email" name="email">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Nacimiento</label>
                      <input class="form-control" type="date" [(ngModel)]="user.fecha_nacimiento"
                        name="fecha_nacimiento">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Ciudad</label>
                      <input class="form-control" [(ngModel)]="user.ciudad" name="ciudad">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">PaÃ­s</label>
                      <input class="form-control" [(ngModel)]="user.pais" name="pais">
                    </div>
                  </div>
                  <button type="submit" class="btn btn-success btn-sm mt-3">Guardar cambios</button>
                </form>
              </div>
              <div>
              </div>
            </div>
          </div>

          <!-- Saldo disponible -->
          <div class="card shadow-sm border-0 mb-4 bg-light-blue"
            style="background: linear-gradient(to right, #e7f1fb, #f9fcff);">
            <div class="card-body d-flex align-items-center">
              <i class="bi bi-wallet2 fs-1 text-primary me-3"></i>
              <div>
                <div class="text-muted small">Saldo disponible Cuenta Vista</div>
                <h3 class="mb-0 fw-bold">{{ saldoDisponible | currency:'CLP':'symbol-narrow':'1.0-0' }}</h3>
              </div>
            </div>
          </div>
          <div class="card shadow-sm border-0 mb-4 bg-light-blue"
            style="background: linear-gradient(to right, #e7f1fb, #f9fcff);">
            <div class="card-body d-flex align-items-center">
              <i class="bi bi-wallet2 fs-1 text-primary me-3"></i>
              <div>
                <div class="text-muted small">Saldo disponible Cuenta de Ahorro</div>
                <h3 class="mb-0 fw-bold">{{ saldoDisponibleAhorro | currency:'CLP':'symbol-narrow':'1.0-0' }}</h3>
              </div>
            </div>
          </div>

          <!-- Consejos -->
          <div class="card shadow-sm border-0 mb-3 bg-warning bg-opacity-25">
            <div class="card-body d-flex align-items-start">
              <i class="bi bi-lightbulb-fill fs-3 text-warning me-3"></i>
              <div>
                <strong>Consejo</strong>
                <p class="mb-0 small">Haz seguimiento de tus transferencias semanalmente para mantener el control
                  financiero.</p>
              </div>
            </div>
          </div>

          <div class="card shadow-sm border-0 mb-4 bg-success bg-opacity-10">
            <div class="card-body d-flex align-items-start">
              <i class="bi bi-check-circle-fill fs-3 text-success me-3"></i>
              <div>
                <strong>Tip Ãºtil</strong>
                <p class="mb-0 small">Recuerda verificar tus tarjetas antes de realizar grandes transferencias.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Columna derecha -->
        <div class="col-lg-4">
          <!-- Botones principales -->
          <div class="d-flex justify-content-center mb-3">
            <a routerLink="/transactions" class="btn btn-primary w-50" style="max-width: 220px;">Transferir</a>
          </div>
          <!-- Cuentas bancarias -->
          <div class="card shadow-sm border-0 mb-3" *ngIf="cuentas.length > 0">
            <div class="card-body">
              <h6 class="fw-semibold mb-3">Tus tarjetas</h6>
              <ng-container *ngFor="let cuenta of cuentas">
                <div *ngFor="let tarjeta of cuenta.cards" class="d-flex align-items-center mb-3">
                  <i class="bi bi-credit-card text-secondary fs-4 me-3"></i>
                  <div>
                    <div class="fw-semibold">{{ cuenta.tipo_cuenta | titlecase }}</div>
                    <small class="text-muted">
                      TerminaciÃ³n â€¢â€¢â€¢â€¢{{ tarjeta.cardNumber.slice(-4) }} â€” Expira: {{ tarjeta.expirationDate }}
                    </small>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>

          <!-- Ayuda -->
          <div class="card border-0 shadow-sm bg-info bg-opacity-10 text-center">
            <div class="card-body p-2 small text-muted">
              Â¿Tienes dudas? Visita la secciÃ³n de <a href="#" class="text-decoration-none">ayuda</a>.
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #loading>
      <div class="text-center py-5">
        <div class="spinner-border text-primary"></div>
        <p class="mt-3">Cargando perfil...</p>
      </div>
    </ng-template>
  </main>

  <!-- Footer -->
  <footer class="bg-light text-center py-4 mt-auto small text-muted">
    <div>
      <img src="assets/logosban.png" alt="MÃ©todos de pago" class="img-fluid mb-2" style="max-width: 400px;">
      <ul class="list-inline mb-1">
        <li class="list-inline-item"><a href="#" class="text-muted text-decoration-none">Contacto</a></li>
        <li class="list-inline-item">Â·</li>
        <li class="list-inline-item"><a href="#" class="text-muted text-decoration-none">Privacidad</a></li>
        <li class="list-inline-item">Â·</li>
        <li class="list-inline-item"><a href="#" class="text-muted text-decoration-none">Avisos legales</a></li>
      </ul>
      <p class="mb-0">&copy; 1999-{{ currentYear }} PayPal, Inc. Todos los derechos reservados.</p>
    </div>
  </footer>
</div>